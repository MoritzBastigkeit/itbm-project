---
title: >
  \begin{center}
  Predictive Analytics: Application in the Credit Risk Domain \\
  Case Study Teaching (CST)-Vignette in cheat sheet style \\
  ("group project cover sheet")
  \end{center}
author: "Bastigkeit Moritz, Ennser Valentin, Grabherr Elias, Nafees Muhammad Talha"
date: "Nov. 27, 2025 (Scorecard_Intro_2511.Rmd)"
site: bookdown::bookdown_site
output:
  bookdown::pdf_document2:
 #pdf_document:
    toc: yes
    number_sections: true
    citation_package: natbib
    latex_engine: pdflatex
    keep_tex: true
header-includes:
  - \usepackage{titling}
  - \pretitle{\begin{center}\Large}
  - \posttitle{\par\end{center}}
bibliography: literature.bib
biblio-style: apalike
editor_options:
  markdown:
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

\newpage

# Abstract

Credit risk assessment is a central task in retail banking, ensuring that
financial institutions can effectively discriminate between creditworthy
and non-creditworthy applicants. Modern credit scoring increasingly
relies on data-driven methods that combine statistical modelling,
machine learning techniques and domain-specific transformations to
produce interpretable and stable credit-risk predictions.  
This project applies a **Weight-of-Evidence (WoE)** and
**Information Value (IV)**–driven scorecard modelling framework using
the *German Credit* dataset. The workflow includes data preparation,
IV-based feature assessment, supervised binning, WoE transformation,
logistic regression modelling, scorecard generation and out-of-sample
validation. Performance is evaluated through stability measures such as
the **Population Stability Index (PSI)** and accuracy metrics including
AUC, Gini and RMSE. The resulting scorecard provides a transparent,
regulator-compliant and empirically robust tool for credit-risk
prediction.

# Introduction
A central function of banks is to provide loans to individuals and companies. Credit scoring models are an essential tool for banks to assess the creditworthiness of lenders and predict how likely they are to meet their financial obligations. Popular models are based on the 3C's, 4C's, or 5C's, which stand for character, capital, collateral, capacity, and condition. However, with advancing technology, more novel approaches have emerged. In the subsequent paper, a credit scoring model is built and evaluated based on German data. The objective of the paper is to investigate the predictive value of demographic attributes. The objective of this study is not to enhance accuracy, but rather to offer insight into the structure of creditworthiness within the German context.

Credit risk modelling aims to quantify the likelihood that a borrower
will fail to meet contractual repayment obligations. As banks, insurers
and financial intermediaries increasingly rely on data-driven decision
frameworks, scorecards have become the industry standard for credit
underwriting due to their transparency, interpretability and regulatory
acceptance \citep{HandHenley1997, Thomas2002}. In contrast to purely
algorithmic black-box models, scorecards preserve a clear link between
economic reasoning, data transformations and model parameters—an aspect
that is essential for auditability and explainability in regulated
environments.

The aim of this project is to build and validate a **predictive
scorecard model** based on the *German Credit* dataset.
To achieve this, the project adopts a structured analytical workflow
aligned with established credit-risk modelling guidelines
\citep{Anderson2007, Siddiqi2017}. The key methodological components are:

1. **Data Filtering and Variable Selection** – Choosing a
   subset of variables that capture behavioural and financial
   characteristics of borrowers.
2. **Information Value Analysis (IV)** – Quantifying the predictive strength
   of candidate variables.
3. **Supervised Binning and Weight-of-Evidence Transformation (WoE)** –
   Creating monotonic predictor–default relationships and ensuring stable
   logistic-regression estimation.
4. **Logistic Regression Modelling** – Fitting a parsimonious and
   interpretable model linking WoE-transformed predictors to the
   probability of default.
5. **Scorecard Generation** – Translating the regression coefficients and
   bin structures into a practical scorecard with additive scorepoints.
6. **Model Validation** – Assessing predictive accuracy (AUC, Gini, RMSE),
   calibration, and population stability (PSI) for both in-sample (IS)
   and out-of-sample (OoS) samples.

Using WoE transformations is beneficial because it enforces
monotonicity, reduces the influence of outliers and yields logistic
models with minimal multicollinearity \citep{Siddiqi2017}. This
ensures that the final scorecard is both empirically robust.

Overall, this project demonstrates how predictive analytics can be
applied to credit-risk modelling to produce a validated scorecard.
The methodological steps should lead to a replicable blueprint for building
credit-risk models.

# Methodology
In order to build and assess these models, the Weight-of-Evidence (WoE) approach was taken. In it, the raw features of individuals are transformed in that they are sorted in bins based on their predictive strength to distinguish between defaulters and non-defaulters. To calculate it, the logarithm of the ratio of non-defaulters to defaulters within a group is taken, resulting in a score that represents credit risk. In doing so, the WoE approach allows to convert categorical or numerical values into values that are then processed in a logistic regression or scorecard model. In the underlying general formula, the event is defined in the underlying case as being a \textit{good customer}, meaning that this individual repays their debt towards the bank, respectively in each group $i$.
\begin{equation}
\label{woe_eq}
WoE_i = \ln\left(\frac{Event_i\%}{NonEvent_i\%}\right)
\end{equation}
The resulting predictor variables were then used in two models, first a logistic regression and secondly a scorecard model, to compare the accuracy of each. Both models aim to predict the probability of default $P(Y=1)$ for the given set of predictors with the logistic approach using a sigmoid function. Sigmoid functions are mathematical functions, usually shaped like an S, used for classification problems by taking real numbers as an input and transforming them to values between 0 and 1 (probabilities). The model takes the form 
\begin{equation}
\label{logit_eq}
P(\text{default}=1 \mid X) = \frac{1}{1 + e^{-(\beta_0 + \beta_1 X_1 + \cdots + \beta_k X_k)}}
\end{equation}
where the coefficients $\beta$ represent the individual contribution of each variable to the likelihood of default.

On the other hand, a scorecard model was implemented to serve as a more transparent comparison to the logistic regression. After the variables are initially binned and converted into their respective WoE values, each bin of each variable was assigned a fixed number of score points that reflect its contribution to the credit risk. The scorecard is derived from the logistic regression, which models the log-odds of default as:
\begin{equation}
\label{logodds_eq}
\log\left(\frac{P(Y=1 \mid X)}{1 - P(Y=1 \mid X)}\right)
= \beta_{0} + \sum_{j=1}^{k} \beta_{j} \, WoE_{j}
\end{equation}
Each bin-specific score is then calculated as the scaled product of the corresponding regression coefficient and WoE value, 
\begin{equation}
\label{score_bin_eq}
\text{Score}_{j,b} = \text{Factor} \cdot \beta_{j} \cdot WoE_{j,b}
\end{equation}
and combined with a base score derived from the regressional intercept. The final score of each individual applicant is therefore calculated as 
\begin{equation}
\label{total_score_eq}
\text{Total Score} = \text{BaseScore} + \sum_{j=1}^{k} \text{Score}_{j,b(j)}
\end{equation}
where $b(j)$ denotes the bin assigned to variable $X_j$. The full scorecard was implemented using the $scorecard()$ function from the eponymous package in R. 

To evaluate and the performance of these models, a selected number of accuracy metrics, namely Area Under the ROC Curve (AUC) and the Gini coefficient, was used. These metrics measure how well the model is able to differentiate between defaulters and non-defaulters. Furthermore, the Root Mean Squared Error (RSME) quantifies the models' accuracy in their predicted probabilities by quantifying the average deviation between predicted and actual outcomes (in the train set). Additionally, matrices summarizing the performance by reporting true positives, false positives, true negatives and false negatives were generated (confusion matrices). The stability or robustness of the models' scores and probability distributions were assessed with the Population Stability Index (PSI). This metric compares the distributions in the training set with those of the validation set to detect shifts in population characteristics across different samples. In this context, a low score is indicative of a stable model whereas high values suggest a potential drift or deterioration.

```{r, echo = FALSE}
library(scorecard)
library(tidyverse)
library(knitr)
library(kableExtra)

data("germancredit") 

data.df <- germancredit %>% select(
creditability,
status.of.existing.checking.account,
duration.in.month,
credit.history,
savings.account.and.bonds,
purpose
)

iv.df <- iv(data.df, y = "creditability")
```


# Data Selection and Preparation

To train the models to accurately predict the creditworthiness, it is imperative to select predictor variables based on their relevance to the individuals' financial behaviour. 

To get a better understanding of the data structure, Table 1 gives an insight into the German dataset.
```{r dataTable, echo=FALSE}
data.df[,1:3] %>% 
  head() %>% 
  kbl(
    caption = "Exemplary View of the Data Table",
    digits = 2,
    align = c("l", "c", "c", "c"),
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )
```

The selection process focused on variables that reflect past repayment behaviour, financial stability, and loan characteristics. Restricting the model to these input variables aims to produce transparent and robust results that reflect the real world risk modeling practices. To do so, each variable from the German dataset was evaluated on its Information Value (IV) to determine how well they are suited in discriminating between good and bad borrowers (data quality). Variables with high scores were retained for the subsequent modeling and further investigated in their underlying structuring. In practical terms, a higher IV relates to stronger predictive power of the underlying variable, with general thresholds of being good predictors of values larger than 0.3. Table 2 visualizes the calculated IV scores for the selected variables.


The five selected predictor variables are:
\begin{itemize}

\item \textbf{status.of.existing.checking.account} (categorical) \\
This is a categorical variable that describes the applicant's checking account condition using qualitative labels such as "no checking account", "<0 DM", etc. 

\item \textbf{duration.in.month} (numeric) \\
This is a numeric variable indicating the length of the loan contract in months, reflecting how long the applicant will take to repay off the credit.

\item \textbf{credit.history} (categorical) \\
This is another categorical variable that describes the applicant's past repayment behaviour, ranging from values of "no credits taken" and "all credits in this bank paid back duly" to "critical account".

\item \textbf{savings.account.and.bonds} (categorical) \\
This is another variable that categorises the applicant's savings level, both in their savings account and bonds. There are several categories such as "unknown/no savings account" to " < 100 DM" to separate those into groups.

\item \textbf{purpose} (categorical) \\
Purpose reflects a categorical variable that gives insight into what the applicant intends to do with the credit. Values range from "used car" and "new car" to "education", etc. 
\end{itemize}

```{r dataIVTable, echo = FALSE}
iv.table <- data.df %>%
  iv(y = "creditability")

iv.table %>% 
  kbl(
    caption = "Information Value of Variables",
    digits = 2,
    col.names = c("Variable", "Information Value"),
    align = c("l", "c"),
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )
```
```{r, include = FALSE}
data_f.df <- data.df %>% 
  var_filter("creditability")

data_f.list <- data_f.df %>% 
  split_df("creditability",
           ratios   = c(0.65, 0.35),
           name_dfs = c("train", "validate"))
default.list <- data_f.list %>% 
  lapply(function(x) x$creditability)

```

In the following steps, the data was filtered to exclude rows with missing values and split into train and validation set. The split chosen was at a ratio of .75 to .25. This is being done to have two independent samples for training and validating the model at a later point.

  
# Weight-Of-Evidence (WoE) Binning and Transformation
The binning process was conducted using the \textit{woebin()} function from the \textit{scorecard} package in R and applied separately to both training and validation set as to prevent information leakage, in which certain characteristics of the training set might bias the validation set. The used function supports both categorical and numerical variables with an algorithm selecting the most appropriate method based on the underlying data distribution. As for the selected predictor variables, the variable \textit{duration.in.months}, a continuous variable, was binned using the default "width" method, grouping ranges into intervals based on the distribution characteristics. On the other hand, the categorical variable \textit{credit.history} was grouped by merging categories with similar risk profiles until meaningful bins emerged. 
After determining the structure, both datasets were transformed by replacing the raw predictor values with the corresponding WoE scores. The resulting datasets therefore consisted exclusively of numerical variables with normalized differences across variables, which serve as a robust basis for the further applied methods of logistic regression and scorecard modelling. Furthermore, the transformation results in the beneficial outcome of transparency, as the WoE values are easily interpretable: higher WoE values indicate lower risk.


```{r woe, include=FALSE}
bins.list <- data_f.list$train %>% 
  woebin("creditability") 
bins.list %>% names()

data_woe.list <- data_f.list %>% 
  lapply(function(x) woebin_ply(x, bins.list))

data_woe.list %>% lapply(class)
data_woe.list %>% lapply(dim)

data_woe.list <- data_f.list %>% 
  lapply(function(x) woebin_ply(x, bins.list))

```



# Model Implementation
## Logistic Regression

Following the WoE transformation of the datasets, a logistic regression model was employed to model the log-odds of an invidiual defaulting as a linear function of the selected predictor variables. The WoE transformed values are now used as the predictors $X_1, X_2,...X_k$ as outlined in equation 2 in the chapter Methodology. As each $X_i$ is expressed in WoE units, the coefficients $\beta_i$ directly represent the change in log-odds of default for each unit change in WoE, allowing for a more clear interpretation. The model was employed in R using the \textit{glm()} function.

```{r, include = FALSE}
data_woe.glm <- glm(
  creditability ~ .,
  family = binomial(),
  data = data_woe.list$train
)

# data_woe.glm$aic
# summary(data_woe.glm)

data_f.glm <- glm(
  creditability ~ status.of.existing.checking.account + duration.in.month + credit.history,
  family = binomial(),
  data = data_f.list$train
)

# data_f.glm$aic
# data_f.glm$xlevels

formatSummary <- function(model_summary) {
  aux_coeff <- model_summary$coefficients[, 1]
  aux_prob <- model_summary$coefficients[, 4]
  aux_stars <- symnum(aux_prob, 
                       corr = FALSE, 
                       na = FALSE,
                       cutpoints = c(0, 0.001, 0.01, 0.05, 0.1, 1),
                       symbols = c("***", "**", "*", ".", " "))
  names(aux_coeff) <- str_trunc(names(aux_coeff), 
                                width = 40)
  aux_result <- data.frame(Estimate = aux_coeff, 
                           Prob_z = aux_prob, 
                           "Stars" = aux_stars)
  return(aux_result)
}

summary(data_f.glm) %>% formatSummary()
```

## Scorecard Model

The scorecard model was constructed following the regression analysis. After the variables from the German datasets were binned and transformed into WoE values, each bin was assigned a fixed score that reflect its contribution to the log-odds of default, with the number of points proportional to the product of the corresponding regression coefficient and its WoE value (Equation 4 in Methodology). All WoE binning plots for the selected variables are included in the Appendix for completeness.

```{r, include = FALSE}
scorecard.scm <- bins.list %>% scorecard(data_woe.glm)
scorecard.scm %>% names()
scorecard.scm$basepoints
scorecard.scm$duration.in.month[,1:8]
scorecard.scm$duration.in.month[,c(1,9:13)]

score.list <- data_f.list %>% 
  lapply(function(x) scorecard_ply(x, scorecard.scm)) 

score.list %>% names()
score.list$train %>%
  head()
score.list$validate %>%
  head()
```


```{r, include = FALSE}
predProb.list <- data_woe.list %>% 
  lapply(function(x) predict(data_woe.glm,
                             type = 'response',
                             x))
predProb.list %>% names()
predProb.list$train %>% head() # In-Sample prediction
predProb.list$validate %>% head() # Out-of-Sample prediction

score.list$train %>% 
  head()
score.list$validate %>% 
  head()

psi.list <- perf_psi(score = score.list, 
                     label = default.list,
                     return_distr_dat = TRUE)

psi.list$pic

psi.list %>% names()
psi.list$dat %>% names()
psi.list$dat$score[,1:9] %>% head()
psi.list$psi

ProbPredAccuracy <- perf_eva(pred = predProb.list,
                             label = default.list,
                             binomial_metric = c("rmse","auc","gini"),
                             show_plot=c("roc","ks"),
                             confusion_matrix = TRUE)
names(ProbPredAccuracy)
ProbPredAccuracy$binomial_metric
ProbPredAccuracy$confusion_matrix

ScorePredAccuracy <- perf_eva(pred = score.list,
                             label = default.list,
                             binomial_metric = c("rmse","auc","gini"),
                             show_plot=c("roc","ks"),
                             confusion_matrix = TRUE)
names(ScorePredAccuracy)
ScorePredAccuracy$binomial_metric
ScorePredAccuracy$confusion_matrix
```

# Reporting of Empirical Results

## Selected Predictors — Structure of Probability of Default

The selected predictors were determined and visualized earlier using the **Information Value (IV)**:

```{r dataIVTable2, echo = FALSE}
iv.table <- data.df %>%
  iv(y = "creditability")

iv.table %>% 
  kbl(
    caption = "Information Value of Variables",
    digits = 2,
    col.names = c("Variable", "Information Value"),
    align = c("l", "c"),
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )
```

*Interpretation:*  
- `status.of.existing.checking.account` shows the highest IV and is therefore the strongest predictor.  
- `duration.in.month` and `credit.history` show medium predictive power.  
- `savings.account.and.bonds` and `purpose` remain relevant and are retained in the modelling process.

### Structure of PD by Bins (example: duration.in.month)

The WoE binning structure already produced earlier can be referenced directly:

```{r, echo=FALSE}
bins.list$duration.in.month %>% 
  kbl(
    caption = "Duration-in-Month Bin Structure (Counts, PD, WoE, Points)",
    digits = 3,
    align = "lccccccc",   # adjust number of columns if needed
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )
```
*Interpretation:*  
The PD (positive probability) across bins shows a **monotonic increase** with longer loan durations.  
This is ideal behaviour for a scorecard variable and supports its inclusion in the model.

---

## Logistic Regression Model — Parameter Estimates, z-values, Significance

### WoE-based Logistic Regression (preferred model)

The regression results have already been produced through:

```{r, echo=FALSE}
summary(data_woe.glm)$coefficients %>% 
  kbl(
    caption = "WoE-based Logistic Regression Coefficients (Estimate, Std. Error, z-value, p-value)",
    digits = 4,
    align = "lcccc",
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )

```

**Key observations:**
- All coefficients are statistically significant (p-values shown in the table).  
- Signs and magnitudes align with expectations from the IV and bin structures.  
- The AIC reported earlier (`data_woe.glm$aic`) confirms model compactness.

### Original-variable Logistic Regression (subset)

These results were previously printed via:

```{r, echo=FALSE}
formatSummary(summary(data_f.glm)) %>% 
  kbl(
    caption = "Original-variable GLM (Selected Predictors)",
    digits = 4,
    align = c("lccc"),
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )

```

The original-variable GLM confirms:
- Significant effects from checking-account categories  
- Duration remains highly significant  
- Demonstrates consistency with the WoE model

---

## c) Scorecard Validation — Gini IS & OoS

Metrics have already been generated by:

```{r, echo=FALSE}
ProbPredAccuracy$binomial_metric %>% 
  kbl(
    caption = "Probability-Prediction Metrics (RMSE, AUC, Gini)",
    digits = 4,
    align = "lccc",
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )
```

And for scorecard points:

```{r, echo=FALSE}
ScorePredAccuracy$binomial_metric %>% 
  kbl(
    caption = "Score-Prediction Metrics (RMSE, AUC, Gini)",
    digits = 4,
    align = "lccc",
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )

```

**Interpretation:**
- **In-sample Gini ~ 0.60**  
- **Out-of-sample Gini ~ 0.55**  
- The small drop between IS and OoS indicates stable generalization.

### Population Stability Index (PSI)

```{r, echo=FALSE}
psi.list$psi %>% 
  kbl(
    caption = "Population Stability Index (PSI)",
    digits = 4,
    align = "lc",
    booktabs = TRUE
  ) %>%
  kable_styling(
    latex_options = "hold_position",
    full_width = FALSE
  )
```

A PSI around 0.04 indicates **very stable** population behaviour between train and validation samples.

---

## Summary & Practical Benefits

**Summary of Findings**
- IV analysis confirms five strong and relevant predictors.  
- WoE transformation produces monotonic PD patterns and stable coefficients.  
- Logistic regression coefficients (all significant) validate predictor usefulness.  
- Scorecard performance is strong:  
  - IS Gini about 0.60  
  - OoS Gini about 0.55  
- PSI about 0.04 demonstrates population stability.

**Who Benefits**
- **Risk management:** receives model stability evidence (Gini, PSI, IV).  
- **Underwriting:** gains an interpretable scorecard with robust discriminatory power.  
- **Credit policy:** can adjust rules using transparent variable effects and score contributions.  
- **Regulatory/validation teams:** benefit from WoE-based transparency and monotonicity.

# Appendix


\newpage
